<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geincos Academy - Acceso</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            background: linear-gradient(45deg, #0f172a, #1e3c72, #2a5298);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .container {
            position: relative; width: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px; backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
            padding: 40px; overflow: hidden; transition: height 0.3s ease;
        }

        h2 { text-align: center; color: #fff; margin-bottom: 30px; font-size: 2rem; font-weight: 600; }

        .role-switch {
            display: flex; justify-content: center; margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3); border-radius: 30px; padding: 5px; position: relative;
            transition: all 0.3s ease;
        }
        .role-option {
            flex: 1; text-align: center; padding: 10px; cursor: pointer;
            color: #ccc; z-index: 2; transition: color 0.3s; font-weight: 600;
        }
        .role-option.active { color: #0f172a; }
        .slider {
            position: absolute; top: 5px; left: 5px; width: 50%; height: calc(100% - 10px);
            background: #fff; border-radius: 25px; transition: transform 0.3s ease; z-index: 1;
        }

        .input-box { position: relative; margin-bottom: 30px; }
        .input-box input {
            width: 100%; padding: 10px 0; font-size: 16px; color: #fff;
            margin-bottom: 5px; border: none; border-bottom: 1px solid #fff;
            outline: none; background: transparent;
        }
        .input-box label {
            position: absolute; top: 0; left: 0; padding: 10px 0; font-size: 16px; color: #fff; pointer-events: none; transition: .5s;
        }
        .input-box input:focus ~ label, .input-box input:valid ~ label { top: -20px; left: 0; color: #3b82f6; font-size: 12px; }
        .input-box i { position: absolute; top: 10px; right: 0; color: #fff; }

        .btn-container { display: flex; flex-direction: column; gap: 15px; }
        button { width: 100%; padding: 15px; border-radius: 30px; cursor: pointer; font-weight: 600; font-size: 16px; transition: 0.3s; }
        .btn-primary { background: #fff; color: #0f172a; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-primary:hover { background: #3b82f6; color: #fff; transform: scale(1.02); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn-secondary { background: transparent; color: #fff; border: 2px solid #fff; }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); }
        
        .error-msg { color: #ff6b6b; text-align: center; margin-top: 10px; font-size: 14px; display: none; background: rgba(0,0,0,0.4); padding: 8px; border-radius: 5px; }
        
        .hidden { display: none !important; }
        .invisible { opacity: 0; pointer-events: none; margin: 0; height: 0; padding: 0; overflow: hidden; }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="formTitle">Bienvenido</h2>

        <div class="role-switch" id="roleSwitch">
            <div class="slider" id="slider"></div>
            <div class="role-option active" onclick="setRole('admin')">Admin</div>
            <div class="role-option" onclick="setRole('asesor')">Asesor</div>
        </div>

        <form id="authForm">
            <div class="input-box hidden" id="emailField">
                <input type="email" id="email" name="Correo" autocomplete="off">
                <label>Correo Electrónico</label>
                <i class="fas fa-envelope"></i>
            </div>

            <div class="input-box">
                <input type="text" id="username" name="Usuario" required autocomplete="off">
                <label>Usuario</label>
                <i class="fas fa-user"></i>
            </div>

            <div class="input-box">
                <input type="password" id="password" name="Contrasena" required>
                <label>Contraseña</label>
                <i class="fas fa-lock"></i>
            </div>

            <input type="hidden" id="roleInput" name="Rol" value="admin">

            <div class="btn-container">
                <button type="submit" class="btn-primary" id="mainBtn">Ingresar</button>
                <button type="button" class="btn-secondary" id="toggleBtn" onclick="toggleMode()">
                    ¿No tienes cuenta? Regístrate
                </button>
            </div>
            
            <p class="error-msg" id="errorMsg"></p>
        </form>
    </div>

    <script>
        // TU URL CONFIRMADA
        const scriptURL = 'https://script.google.com/macros/s/AKfycbynWy1GywLPWMLPM94Sp0Hc40zJTY3BVkBw4aRErOkITmsDAmFzehFEiAh6vhO79NmFYQ/exec';
        
        let currentRole = 'admin'; 
        let isLoginMode = true;
        const form = document.forms['authForm'];
        const roleInput = document.getElementById('roleInput');
        const errorMsg = document.getElementById('errorMsg');
        const roleSwitch = document.getElementById('roleSwitch');

        function setRole(role) {
            currentRole = role;
            roleInput.value = role; 
            const slider = document.getElementById('slider');
            const options = document.querySelectorAll('.role-option');
            
            if (role === 'admin') {
                slider.style.transform = 'translateX(0%)';
                options[0].classList.add('active');
                options[1].classList.remove('active');
            } else {
                slider.style.transform = 'translateX(100%)';
                options[1].classList.add('active');
                options[0].classList.remove('active');
            }
        }

        function toggleMode() {
            isLoginMode = !isLoginMode;
            const title = document.getElementById('formTitle');
            const emailField = document.getElementById('emailField');
            const mainBtn = document.getElementById('mainBtn');
            const toggleBtn = document.getElementById('toggleBtn');

            errorMsg.style.display = 'none'; 
            form.reset();

            if (isLoginMode) {
                title.innerText = "Bienvenido";
                emailField.classList.add('hidden');
                document.getElementById('email').required = false;
                mainBtn.innerText = "Ingresar";
                toggleBtn.innerText = "¿No tienes cuenta? Regístrate";
                roleSwitch.classList.remove('invisible'); 
                roleInput.value = currentRole; 
            } else {
                title.innerText = "Crear Cuenta";
                emailField.classList.remove('hidden');
                document.getElementById('email').required = true;
                mainBtn.innerText = "Registrar Usuario";
                toggleBtn.innerText = "Ya tengo cuenta. Iniciar Sesión";
                roleSwitch.classList.add('invisible'); 
                roleInput.value = 'asesor'; // IMPORTANTE: Forzamos asesor al entrar en registro
            }
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            const btn = document.getElementById('mainBtn');
            const originalText = btn.innerText;
            const action = isLoginMode ? 'login' : 'register';
            const usuarioIngresado = document.getElementById('username').value;
            
            let formData = new FormData(form);
            formData.append('action', action); 

            // CORRECCIÓN: Al registrar, forzamos que sea 'asesor' para coincidir con el botón de login
            if (action === 'register') {
                formData.set('Rol', 'asesor'); 
            } else {
                formData.set('Rol', roleInput.value); 
            }

            btn.innerText = "Procesando...";
            btn.disabled = true;
            errorMsg.style.display = 'none';

            fetch(scriptURL, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                btn.innerText = originalText;
                btn.disabled = false;

                if (data.result === 'success') {
                    if (action === 'register') {
                        alert("¡Registro Exitoso! Ahora inicia sesión.");
                        toggleMode(); 
                    } else {
                        // LOGIN EXITOSO
                        localStorage.setItem('usuarioActual', usuarioIngresado);

                        if (currentRole === 'admin') {
                            window.location.href = 'panel-admin.html';
                        } else {
                            window.location.href = 'panel-usuario.html';
                        }
                    }
                } else {
                    // CORRECCIÓN VISUAL: Si no hay mensaje del servidor, ponemos uno por defecto
                    errorMsg.innerText = data.message || "Usuario o contraseña incorrectos";
                    errorMsg.style.display = 'block';
                    shakeCard();
                }
            })
            .catch(error => {
                console.error('Error!', error.message);
                btn.innerText = originalText;
                btn.disabled = false;
                errorMsg.innerText = "Error de conexión.";
                errorMsg.style.display = 'block';
            });
        });

        function shakeCard() {
            document.querySelector('.container').animate([
                { transform: 'translateX(0px)' }, { transform: 'translateX(10px)' },
                { transform: 'translateX(-10px)' }, { transform: 'translateX(0px)' }
            ], { duration: 300 });
        }
    </script>

</body>
</html>